$def with (game, past = [], error = None)

$var css: <link rel="stylesheet" href="/static/css/guess-form.css">

$if game["won"] in [0,1]:
    $var link1: <a class="item" href="/setup"><i class="game icon"></i> Back to Levels</a>

$if not game["won"] in [0,1]:
    $var link3: <a class="item" href="/quit"><i class="power icon"></i> Quit Game</a>

$var logout: True

$ goldCoins = game["goldCoins"]
$ silverCoins = game["silverCoins"]
$ length = int(game["digits"])
$ complexity = int(game["complexity"])
$ _round = len(past) + 1
$ password = game["password"]

$if complexity == 0:
    $ inputType = "only numbers"
    $ inputSet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
    $ keyboardType = "tel"
$elif complexity == 1:
    $ inputType = "only letters"
    $ inputSet = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'r', 's', 't', 'u', 'v', 'y', 'z', 'x', 'q', 'w']
    $ keyboardType = "text"
$elif complexity == 2:
    $ inputType = "both numbers and letters"
    $ inputSet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'r', 's', 't', 'u', 'v', 'y', 'z', 'x', 'q', 'w']
    $ keyboardType = "text"
$elif complexity == 3:
    $ inputType = "both numbers and lower- and upper-case letters"
    $ inputSet = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'r', 's', 't', 'u', 'v', 'y', 'z', 'x', 'q', 'w', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z']
    $ keyboardType = "text"


$if len(past) == 0:
    $ goldInBag = goldCoins
    $ silverInBag = silverCoins
$else:
    $ goldInBag = past[0][4]
    $ silverInBag = past[0][5]

<div style="display: none;">
    <svg>
        <defs>
            <g id="coin">
                <path class='gloss' d="M13.9387359,64.451017 L27.907266,49.6820937 C82.4692719,50.6175618 189.837109,110.567663 310.406076,103.496346 C430.975044,96.4250287 487.104753,64.451017 557.125428,51.323821 L570.508678,64.451017 C546.487268,117.35011 436.789071,148.831012 303.479195,148.831012 C170.169318,148.831012 49.5324538,125.435936 13.9387359,64.451017 Z" fill-rule="nonzero" fill="#FFF"/>
                <path class='metal' d="M14.107472,64.5 C4.94822495,73.9509372 0,84.0328486 0,94.5 C0,148.347763 130.956711,192 292.5,192 C454.043289,192 585,148.347763 585,94.5 C585,84.0328486 580.051775,73.9509372 570.892528,64.5 C532.932464,103.66896 422.641835,132 292.5,132 C162.358165,132 52.0675363,103.66896 14.107472,64.5 Z" fill-rule="nonzero"/>
                <path class='metal' d="M292.022022,118.115721 C436.883763,118.115721 528.105858,86.8201851 554.317407,58 C580.528956,29.1798149 436.883763,0.19767157 292.022022,0.19767157 C147.16028,0.19767157 2.38237853,29.2670945 29.7266362,58 C57.0708939,86.7329055 147.16028,118.115721 292.022022,118.115721 Z" fill-rule="nonzero"/>
            </g>
            <g id="coin-side">
                <path class='gloss' d="M26.388.288L13.938 13.45c35.594 60.986 156.23 84.38 289.54 84.38 133.31 0 243.01-31.48 267.03-84.38L557.416.608c-.147 2.124-1.157 4.26-3.098 6.393-26.21 28.82-117.433 60.116-262.295 60.116C147.16 67.116 57.072 35.733 29.727 7c-2.132-2.24-3.218-4.482-3.34-6.712z" fill-rule="nonzero" fill="#FFF"/>
                <path class='metal' d="M14.107 13.5C4.947 22.95 0 33.033 0 43.5 0 97.348 130.957 141 292.5 141S585 97.348 585 43.5c0-10.467-4.948-20.55-14.107-30C532.933 52.67 422.643 81 292.5 81 162.358 81 52.068 52.67 14.107 13.5z" fill-rule="nonzero"/>
            </g>
            <g id="coin-bag">
                <path d="M115 28.75c3.75 5 8.75 7.5 13.75 10C126.25 45 125 50 123.75 55h-6.25c-3.75 0-8.75-1.25-12.5-1.25-1.25-2.5-3.75-6.25-5-8.75 0-1.25-1.25-2.5-1.25-2.5C103.75 40 110 35 115 28.75zM115 0c-6.25 0-12.5 1.25-18.75 11.25C91.25 20 83.75 20 72.5 20c-10 0-12.5 7.5-7.5 15 2.5 3.75 18.75 31.25 22.5 37.5 3.75 5 18.75 8.75 30 8.75h2.5c11.25 0 28.75-5 27.5-13.75-1.25-16.25 15-37.5 17.5-40 3.75-5 2.5-16.25-7.5-16.25-2.5 0-5 0-7.5 1.25s-6.25 2.5-10 2.5c-2.5 0-5-1.25-6.25-3.75C126.25 1.25 120 0 115 0z" class="cloth" fill-rule="nonzero"/>
                <path d="M87.5 72.5c3.75 6.25 21.25 8.75 32.5 8.75s28.75-5 27.5-13.75c-1.25-16.25 15-37.5 17.5-40-5 2.5-8.75 6.25-13.75 5C148.75 35 142.5 50 130 50c-8.75 0-10-12.5-16.25-12.5s-7.5 8.75-12.5 10C90 50 81.25 38.75 75 31.25c-2.5 0-7.5-3.75-10 5 2.5 2.5 18.75 30 22.5 36.25zM145 85c-8.75 3.75-18.75 6.25-25 6.25h-2.5c-2.5 0-13.75 0-23.75-3.75C40 103.75 0 158.75 0 197.5 0 243.75 56.25 250 125 250s125-6.25 125-52.5c0-41.25-45-100-105-112.5z" class="cloth" fill-rule="nonzero"/>
                <path d="M69.75 138.875c.5-1.083 1.542-2.208 3.125-3.375 1.583-1.167 3.417-2.23 5.5-3.188 2.083-.958 4.312-1.77 6.688-2.437 2.375-.667 4.604-1.042 6.687-1.125.667 0 1.354.125 2.063.375.708.25 1.395.375 2.062.375.667 0 1.333-.062 2-.188.667-.125 1.25-.187 1.75-.187 3.167.333 5.854 1.375 8.063 3.125 2.208 1.75 3.812 3.583 4.812 5.5 1 2 1.458 3.98 1.375 5.938-.083 1.958-.48 3.854-1.188 5.687-.708 1.833-1.645 3.562-2.812 5.188-1.167 1.625-2.375 3.104-3.625 4.437-.667.5-1.625.98-2.875 1.438-1.25.458-2.5.77-3.75.937-.833.417-1.583.563-2.25.438-.667-.126-.833.104-.5.687 0 .167.146.27.438.313.29.04.52.145.687.312 1.25.25 2.5.458 3.75.625 1.25.167 2.48.417 3.688.75 1.208.333 2.374.792 3.5 1.375 1.125.583 2.23 1.417 3.312 2.5 1.583 1.583 2.833 3.208 3.75 4.875.917 1.667 1.375 3.292 1.375 4.875.417 2.25.25 4.77-.5 7.563-.75 2.79-1.833 5.145-3.25 7.062-1.75 2.083-3.917 3.667-6.5 4.75-2.583 1.083-4.958 2.167-7.125 3.25-1.75.75-3.583 1.25-5.5 1.5-1.917.25-3.812.375-5.688.375-1.875 0-3.624-.083-5.25-.25-1.625-.167-2.98-.25-4.062-.25-2.083 0-3.854-.25-5.313-.75-1.458-.5-2.812-.958-4.062-1.375-.583-.167-1.25-.48-2-.938-.75-.458-1.437-.98-2.063-1.562-.625-.583-1.145-1.208-1.562-1.875-.417-.667-.625-1.292-.625-1.875-.167-.667.125-1.125.875-1.375s1.375-.708 1.875-1.375c.333-.75.708-1.458 1.125-2.125.417-.667.875-1.208 1.375-1.625.5-.417 1.02-.625 1.563-.625.54 0 1.062.292 1.562.875.667.917 1.917 2.104 3.75 3.563 1.833 1.458 3.937 2.73 6.313 3.812 2.375 1.083 4.812 1.73 7.312 1.938 2.5.208 4.792-.563 6.875-2.313 1.083-1.083 2.167-2.333 3.25-3.75 1.083-1.417 1.625-3.083 1.625-5 0-1.667-.25-3.375-.75-5.125s-1.208-3.396-2.125-4.938c-.917-1.54-2.042-2.895-3.375-4.062-1.333-1.167-2.833-2-4.5-2.5-.667-.417-1.604-.833-2.813-1.25-1.208-.417-2.687-.833-4.437-1.25-.667-.083-1.27-.063-1.813.063-.54.125-1.04.23-1.5.312-.458.083-.895.042-1.312-.125-.417-.167-.833-.583-1.25-1.25-.25-.5-.5-1.062-.75-1.688-.25-.625-.417-1.208-.5-1.75-.083-.54-.063-1.02.063-1.437.125-.417.395-.667.812-.75 1.083-.417 2.5-.625 4.25-.625s3.562-.146 5.438-.438c1.875-.29 3.73-.895 5.562-1.812 1.833-.917 3.458-2.5 4.875-4.75.667-.667 1.062-1.458 1.188-2.375.125-.917.187-1.958.187-3.125-.167-.75-.417-1.625-.75-2.625s-.792-1.958-1.375-2.875-1.27-1.625-2.063-2.125c-.79-.5-1.687-.625-2.687-.375-.917 0-1.625-.02-2.125-.063-.5-.04-1.208-.145-2.125-.312-.917 0-1.73.083-2.438.25-.708.167-1.52.417-2.437.75-.083.083-.375.437-.875 1.063-.5.625-1.083 1.333-1.75 2.125-.667.79-1.417 1.583-2.25 2.375-.833.79-1.625 1.395-2.375 1.812-1.25.5-2.437.438-3.563-.188-1.125-.625-1.687-2.062-1.687-4.312.083-.417.083-.75 0-1s-.187-.5-.313-.75c-.125-.25-.208-.5-.25-.75-.04-.25.02-.583.188-1zm76.375-9.125c1.25-.667 2.73-1.083 4.438-1.25 1.708-.167 3.5-.208 5.375-.125 1.875.083 3.73.23 5.562.438 1.833.208 3.458.312 4.875.312 1.917.333 3.792.937 5.625 1.813 1.833.875 3.208 2.104 4.125 3.687.417.75.792 1.812 1.125 3.188.333 1.375.604 2.77.813 4.187.208 1.417.354 2.73.437 3.938.083 1.208.083 1.98 0 2.312 0 5-.27 9.937-.813 14.813-.54 4.875-1.583 9.5-3.125 13.875-1.54 4.375-3.666 8.416-6.375 12.125-2.708 3.708-6.23 6.895-10.562 9.562-1.667 1-3.542 1.792-5.625 2.375s-4.23.958-6.438 1.125c-2.208.167-4.395.125-6.562-.125-2.167-.25-4.167-.667-6-1.25-.917-.167-1.646-.292-2.188-.375-.54-.083-1.312-.333-2.312-.75-1.583-.833-2.73-2.27-3.438-4.313-.708-2.04-1.187-4.25-1.437-6.625s-.354-4.708-.313-7c.042-2.29.02-4.187-.062-5.687 0-1.5.02-3.312.063-5.438.04-2.125.124-4.333.25-6.625.125-2.29.354-4.5.687-6.625.333-2.125.792-3.895 1.375-5.312 2.417-5.167 5.354-9.417 8.813-12.75 3.458-3.333 7.354-6.5 11.687-9.5zM145.5 142c-1.917.75-3.208 1.646-3.875 2.688-.667 1.04-1.083 2.124-1.25 3.25-.167 1.125-.25 2.27-.25 3.437 0 1.167-.292 2.333-.875 3.5 0 .5-.125.917-.375 1.25-.25.333-.375.833-.375 1.5v4.875c-.5.917-.917 1.75-1.25 2.5-.333.75-.5 1.625-.5 2.625 0 1.583.23 3.167.688 4.75.458 1.583.604 3.167.437 4.75v4.188c0 1.375.458 2.854 1.375 4.437 1.167 1.917 2.48 3.333 3.938 4.25 1.458.917 3.145 1.458 5.062 1.625.667.083 1.396-.02 2.188-.313.79-.29 1.562-.666 2.312-1.125.75-.458 1.437-.98 2.063-1.562.625-.583 1.104-1.083 1.437-1.5 2.25-2.25 4.167-5.25 5.75-9 1.583-3.75 2.625-7.687 3.125-11.813.5-4.125.354-8.208-.438-12.25-.79-4.04-2.437-7.48-4.937-10.312-.917-1.083-2.02-1.73-3.313-1.938-1.29-.208-2.395-.52-3.312-.937-1.083-.5-2.396-.604-3.938-.313-1.54.292-2.77.77-3.687 1.438z" fill="#FFF"/>
            </g>
        </defs>
    </svg>
</div>

$if error:
    <div class="ui red message"><i class="remove sign icon"></i> $error</div>


$if game["won"] in [0, 1]:
    <div class="boxes">
    $ m = '*******\n*     *\n*     *\n*     *\n*     *\n*******'
    $for i in range(length):
        <div class="box"><pre data-pass="$password[i]">$m</pre></div>
    </div>
$else:
    <h2 class="ui header center aligned">Make your guess:</h2>
    <form class="guess" name="main" method="POST">
        <div class="boxes">
        $ m = '*******\n*     *\n*     *\n*     *\n*     *\n*******'
        $ names = ["first", "second", "third", "fourth", "fifth", "sixth", "seventh", "eighth"]
        $for i in range(length):
            <div class="box">
                <input type="$keyboardType" name="$names[i]" maxlength=1 size=1 placeholder="*" autocomplete="off" autocapitalize="none"/>
                <pre class="azicik-asagida-olsun" data-pass="">$m</pre>
            </div>
        </div>
        <div class="submit-field">
            <button type="submit" class="ui primary button"> Go! </button>
        </div>
    </form>
$if game["won"] == 1:
    $ goldInBag = goldInBag
    <h2 class="ui header center aligned">You won this game already!</h2>
$elif game["won"] == 0:
    $ goldInBag = 0
    $ silverInBag = 0
    <h2 class="ui header center aligned">You lost this game already!</h2>
<div class="ui divider"></div>
<div class="login-page ui two column very relaxed stackable grid">
    <div class="column">
        <h3 class="ui header">Past Guesses</h3>
        <table class="ui celled table center aligned unstackable">
            <thead>
                <tr>
                    <th>Round</th>
                    <th>Guess</th>
                    <th>Gold Coins</th>
                    <th>Silver Coins</th>
                </tr>
            </thead>
            <tbody>
                $if len(past) > 0:
                    $for row in past:
                        $ gold = '-'
                        $ silver = '-'
                        $if row[2] != length:
                            $ gold = row[2]
                        $if row[2] != length:
                            $ silver = row[3]
                        <tr>
                            <td>$row[0]</td>
                            <td><code>$row[1]</code></td>
                            <td><div class="ui yellow circular label">$gold</div></td>
                            <td><div class="ui grey circular label">$silver</div></td>
                        </tr>
                $else:
                        <tr>
                            <td colspan="4">Your guesses with their results will appear here.</td>
                        </tr>
            </tbody>
        </table>
    </div>
    <div class="column">
        <h3 class="ui header">Your Remaining Coins</h3>
        <table class="ui celled table center aligned unstackable">
            <thead>
                <tr>
                    <th>$goldInBag Gold</th>
                    <th>$silverInBag Silver</th>
                </tr>
                <tr>
                    <td colspan="2">
                        $if game["won"] == 1:
                            $ goldInBag = goldInBag + past[-1][2]
                        $elif game["won"] == 0:
                            $ goldInBag = 0
                            $ silverInBag = 0
                        <div class="coins">
                            $ coins = goldInBag

                            $ bags = coins / 30
                            $ fullStacks = coins % 30 / 10
                            $ remainingCoins = coins % 30 % 10

                            $if remainingCoins > 0:
                                <div class="coin-stack">
                                $for i in range(remainingCoins):
                                    $if i == 0:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin"></use></svg>
                                    $else:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin-side"></use></svg>
                                </div>
                            $for i in range(fullStacks):
                                <div class="coin-stack">
                                $for i in range(10):
                                    $if i == 0:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin"></use></svg>
                                    $else:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin-side"></use></svg>
                                </div>
                            $for i in range(bags):
                                <div class="coin-bag">
                                    <svg class='gold' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><use xlink:href="#coin-bag"></use></svg>
                                </div>
                        </div>
                        <div class="coins silver">
                            $ coins = silverInBag

                            $ bags = coins / 30
                            $ fullStacks = coins % 30 / 10
                            $ remainingCoins = coins % 30 % 10

                            $if remainingCoins > 0:
                                <div class="coin-stack">
                                $for i in range(remainingCoins):
                                    $if i == 0:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin"></use></svg>
                                    $else:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin-side"></use></svg>
                                </div>
                            $for i in range(fullStacks):
                                <div class="coin-stack">
                                $for i in range(10):
                                    $if i == 0:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin"></use></svg>
                                    $else:
                                        <svg class='coin' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 585 192"><use xlink:href="#coin-side"></use></svg>
                                </div>
                            $for i in range(bags):
                                <div class="coin-bag">
                                    <svg class='gold' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 250"><use xlink:href="#coin-bag"></use></svg>
                                </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <h4 class="ui header">Possible characters:</h4>
                        <div class="ui circular labels">
                            $for input in inputSet:
                                <div class="ui gray circular label">$input</div>
                        </div>
                    </td>
                </tr>
            </thead>
        </table>
    </div>
</div>
$if not game["won"] in [0, 1]:
    <script>
      window.inputSet = $:inputSet;
    </script>
    <script type="text/javascript" src="/static/js/input-ux.js"></script>